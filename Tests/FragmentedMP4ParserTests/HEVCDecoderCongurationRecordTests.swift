import XCTest

@testable import FragmentedMP4Parser

class HEVCDecoderConfigurationRecordTests: XCTestCase {
    static var allTests: [(String, (HEVCDecoderConfigurationRecordTests) -> () -> Void)] = [
    ]

    let buffer = Buffer(storage: [
        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, // Header
        0x01,  // Version
        0x02,  // profile_indication
        0x20, 0x00, 0x00, 0x00,  // general_profile_compatibility_flags
        // general_constraint_indicator_flags
        0x90, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x3F,  // general_level_idc
        0xF0, 0x00, 0xFC, 0xFD, 0xFA, 0xFA, 0x00, 0x00,
        0x0F,  // length_size_minus_one
        0x02,  // num_of_arrays
        // array 1
        0x20,  // nal type
        0x00, 0x01,  // num nalus
        // nalu 1
        0x00, 0x18,  // nal unit length
        0x40, 0x01, 0x0C, 0x01, 0xFF, 0xFF, 0x02, 0x20,
        0x00, 0x00, 0x03, 0x00, 0x90, 0x00, 0x00, 0x03, 0x00, 0x00, 0x03,
        0x00, 0x3F, 0x99, 0x98, 0x09,
        // array 2
        0x21,  // nal type
        0x00, 0x01,  // num nalus
        // Nalu 1
        0x00, 0x0f,  // nal unit length
        0x42, 0x01, 0x01, 0x02, 0x20, 0x00, 0x00, 0x03, 0x00, 0x90,
        0x00, 0x00, 0x03, 0x00, 0x00
    ])

    func testSuccessfulParsing() {
        let record = HEVCDecoderConfigurationRecord(buffer: buffer)

        XCTAssertEqual(record.profileString, "2.4000000.L63.90")
    }
}

